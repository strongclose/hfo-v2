---
import BaseLayout from '../../layouts/BaseLayout.astro';
const { slug } = Astro.params;

// Mock doctor data - in production, fetch from CMS
const doctor = {
  name: slug === "dr-smith-cardiology-94610" ? "Dr. Sarah Smith, MD" : "Dr. John Doe, MD",
  type: "doctor",
  specialty: "Cardiology",
  address: {
    street: "2500 Milvia Street",
    city: "Berkeley",
    state: "CA",
    zip: "94704",
  },
  website: "https://www.drsmith-cardiology.com",
  phone: "(510) 555-0123",
  email: "contact@drsmith-cardiology.com",
  description: "Board-certified cardiologist specializing in interventional cardiology and preventive heart care with over 15 years of experience.",
  transparencyScore: 92,
  lastUpdated: "March 20, 2024",
  procedureCount: 89,
  payerCount: 12,
};

// Mock procedures data for doctor
const procedures = [
  {
    id: "1",
    code: "99213",
    type: "CPT",
    name: "Cardiology Consultation - Established Patient",
    description: "Cardiology Consultation - Established Patient",
    grossCharge: 450,
    inNetworkAverage: 320,
    selfPayRate: 380,
    frequency: "Common",
  },
  {
    id: "2",
    code: "93306",
    type: "CPT",
    name: "Echocardiogram with Doppler",
    description: "Echocardiogram with Doppler",
    grossCharge: 1200,
    inNetworkAverage: 850,
    selfPayRate: 950,
    frequency: "Common",
  },
  {
    id: "3",
    code: "93000",
    type: "CPT",
    name: "Electrocardiogram (ECG/EKG)",
    description: "Electrocardiogram (ECG/EKG)",
    grossCharge: 180,
    inNetworkAverage: 120,
    selfPayRate: 150,
    frequency: "Common",
  },
  {
    id: "4",
    code: "92928",
    type: "CPT",
    name: "Percutaneous Coronary Angioplasty",
    description: "Percutaneous Coronary Angioplasty",
    grossCharge: 15000,
    inNetworkAverage: 12000,
    selfPayRate: 13500,
    frequency: "Moderate",
  },
];

// Mock comparison data
const comparisonData = {
  entityName: doctor.name,
  entityType: "doctor",
  averageCost: 485,
  regionalRanking: 8,
  totalInRegion: 23,
  costVsAverage: -12.8,
  qualityRating: 5,
  specialtyRanking: 3,
  nearbyCompetitors: [
    {
      name: "Dr. Michael Chen, MD",
      distance: "1.2 miles",
      averageCost: 520,
      qualityRating: 4,
      type: "Interventional Cardiology",
    },
    {
      name: "Dr. Lisa Rodriguez, MD",
      distance: "2.8 miles",
      averageCost: 490,
      qualityRating: 5,
      type: "General Cardiology",
    },
  ],
  regionalStats: {
    averageCost: 555,
    medianCost: 520,
    highestCost: 750,
    lowestCost: 380,
    totalProviders: 23,
  },
};
---

<BaseLayout 
  title={`${doctor.name} - Doctor Profile | Hospital Fees`}
  description={doctor.description}
>
  <div class="min-h-screen flex flex-col bg-gray-50">
    <div class="flex-1">
      <!-- Provider Hero Component -->
      <div class="bg-white border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
          <div class="flex flex-col lg:flex-row items-start gap-8">
            <div class="flex-1">
              <div class="flex items-center gap-4 mb-4">
                <div class="w-16 h-16 bg-blue-100 rounded-lg flex items-center justify-center">
                  <svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                  </svg>
                </div>
                <div>
                  <h1 class="text-3xl font-bold text-gray-900">{doctor.name}</h1>
                  <div class="flex items-center gap-2 mt-1">
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                      {doctor.specialty}
                    </span>
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                      Score: {doctor.transparencyScore}
                    </span>
                  </div>
                </div>
              </div>

              <p class="text-lg text-gray-600 mb-6">{doctor.description}</p>

              <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                <div class="text-center p-4 bg-gray-50 rounded-lg">
                  <div class="text-2xl font-bold text-gray-900">{doctor.procedureCount}</div>
                  <div class="text-sm text-gray-600">Procedures</div>
                </div>
                <div class="text-center p-4 bg-gray-50 rounded-lg">
                  <div class="text-2xl font-bold text-gray-900">{doctor.payerCount}</div>
                  <div class="text-sm text-gray-600">Insurance Plans</div>
                </div>
                <div class="text-center p-4 bg-gray-50 rounded-lg">
                  <div class="text-2xl font-bold text-gray-900">{doctor.transparencyScore}</div>
                  <div class="text-sm text-gray-600">Transparency Score</div>
                </div>
                <div class="text-center p-4 bg-gray-50 rounded-lg">
                  <div class="text-2xl font-bold text-gray-900">5★</div>
                  <div class="text-sm text-gray-600">Quality Rating</div>
                </div>
              </div>

              <div class="flex flex-wrap gap-3">
                <a 
                  href={`mailto:${doctor.email}`}
                  class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
                >
                  Contact Doctor
                </a>
                <a 
                  href={doctor.website}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
                >
                  Visit Website
                </a>
                <a 
                  href={`tel:${doctor.phone}`}
                  class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
                >
                  {doctor.phone}
                </a>
              </div>
            </div>

            <div class="w-full lg:w-80">
              <div class="bg-white p-6 rounded-lg shadow">
                <h3 class="text-lg font-semibold mb-4">Contact Information</h3>
                <div class="space-y-3">
                  <div>
                    <div class="text-sm font-medium text-gray-600">Address</div>
                    <div class="text-sm">
                      {doctor.address.street}<br/>
                      {doctor.address.city}, {doctor.address.state} {doctor.address.zip}
                    </div>
                  </div>
                  <div>
                    <div class="text-sm font-medium text-gray-600">Phone</div>
                    <div class="text-sm">{doctor.phone}</div>
                  </div>
                  <div>
                    <div class="text-sm font-medium text-gray-600">Website</div>
                    <a href={doctor.website} target="_blank" rel="noopener noreferrer" class="text-sm text-blue-600 hover:underline">
                      Visit Site
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Procedures Table -->
      <div class="bg-white py-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <h2 class="text-2xl font-bold text-gray-900 mb-8">Procedures & Pricing</h2>
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
              <thead class="bg-gray-50">
                <tr>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Procedure</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Code</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Gross Charge</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">In-Network Avg</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Self-Pay Rate</th>
                </tr>
              </thead>
              <tbody class="bg-white divide-y divide-gray-200">
                {procedures.map(procedure => (
                  <tr key={procedure.id}>
                    <td class="px-6 py-4 whitespace-nowrap">
                      <div class="text-sm font-medium text-gray-900">{procedure.name}</div>
                      <div class="text-sm text-gray-500">{procedure.frequency}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{procedure.code}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${procedure.grossCharge.toLocaleString()}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${procedure.inNetworkAverage.toLocaleString()}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${procedure.selfPayRate.toLocaleString()}</td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Legal Disclaimer -->
      <div class="py-4 bg-white border-t">
        <div class="w-full px-4 md:px-6 lg:px-8">
          <div class="max-w-7xl mx-auto">
            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
              <p class="text-sm text-yellow-800">
                <strong>Disclaimer:</strong> Pricing information is based on publicly available data and may not reflect current rates. 
                Contact the provider directly for accurate pricing. This information is for educational purposes only.
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- Comparison Section -->
      <div class="py-12 bg-gray-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <h2 class="text-2xl font-bold text-gray-900 mb-8">How This Doctor Compares</h2>
          <div class="grid lg:grid-cols-2 gap-8">
            <div class="bg-white p-6 rounded-lg shadow">
              <h3 class="text-lg font-semibold mb-4">Regional Ranking</h3>
              <div class="text-3xl font-bold text-blue-600 mb-2">
                #{comparisonData.regionalRanking} <span class="text-lg text-gray-600">of {comparisonData.totalInRegion}</span>
              </div>
              <p class="text-sm text-gray-600">in the region by average cost</p>
            </div>
            
            <div class="bg-white p-6 rounded-lg shadow">
              <h3 class="text-lg font-semibold mb-4">Cost vs Average</h3>
              <div class="text-3xl font-bold text-green-600 mb-2">
                {comparisonData.costVsAverage}%
              </div>
              <p class="text-sm text-gray-600">below regional average</p>
            </div>
          </div>

          <!-- Nearby Competitors -->
          <div class="mt-8">
            <h3 class="text-lg font-semibold mb-4">Nearby Doctors</h3>
            <div class="grid md:grid-cols-2 gap-4">
              {comparisonData.nearbyCompetitors.map((competitor, idx) => (
                <div key={idx} class="bg-white p-4 rounded-lg shadow">
                  <div class="flex justify-between items-start">
                    <div>
                      <div class="font-medium">{competitor.name}</div>
                      <div class="text-sm text-gray-600">{competitor.type}</div>
                      <div class="text-sm text-gray-600">{competitor.distance}</div>
                    </div>
                    <div class="text-right">
                      <div class="font-semibold">${competitor.averageCost}</div>
                      <div class="text-sm text-gray-600">{competitor.qualityRating}★ rating</div>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</BaseLayout>
